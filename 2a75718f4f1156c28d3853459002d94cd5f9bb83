{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4ef317b6_67577285",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017430
      },
      "writtenOn": "2023-06-08T21:03:34Z",
      "side": 1,
      "message": "doesn\u0027t this make lmkd less aggressive in favor of spending more time in kswapd?",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5898550_1e1b9fe3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-08T21:08:24Z",
      "side": 1,
      "message": "Yes but this way the calculation does not underestimate the amount of data swap can accomodate before it runs out of space. Current calculation assumes data to be always uncompressible (worst case scenario) which leads to LMKD being overly aggressive (see the bug in the description).",
      "parentUuid": "4ef317b6_67577285",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38f37053_e84cb35f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1017430
      },
      "writtenOn": "2023-06-08T21:14:39Z",
      "side": 1,
      "message": "We already have strong evidence that lmkd is too conservative about killing during bursty allocations. I don\u0027t think we should be changing this without a clear idea of the precise impact.",
      "parentUuid": "c5898550_1e1b9fe3",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c987aa7_ab832254",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-08T21:28:19Z",
      "side": 1,
      "message": "Partner reports that this calculation makes lmkd overly aggressive for their device. Should I make the compression ratio configurable with 1x as a default and let partners reset it when required?",
      "parentUuid": "38f37053_e84cb35f",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "abda9325_fcb4eda7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2023-06-08T21:46:24Z",
      "side": 1,
      "message": "The patch fixes the free swap calculation correctly, which is a worthwhile improvement by itself. However, it would also introduce less aggressive LMKD kill behavior compared to the previous version.\n\nIs it possible to adjust the other LMKD aggressiveness knobs to bring the new behavior on par with the old behavior, or even more aggressive? And then vendor could adjust these knobs themselves, then.",
      "parentUuid": "6c987aa7_ab832254",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db90171c_bd3e35aa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-08T22:10:57Z",
      "side": 1,
      "message": "Unfortunately adjusting other knobs will have additional side-effects. For example if we instead adjust the low_swap limit to compensate for this 1x compression ration then we will be less aggressive when FreeSwap drops lower than the current low_swap limit. I think a separate knob would be the right way to solve this if we indeed don\u0027t want to change current lmkd behavior and to solve partner\u0027s issue.",
      "parentUuid": "abda9325_fcb4eda7",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2b0ba3f_c35a704e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2023-06-08T22:20:09Z",
      "side": 1,
      "message": "The LMKD behavior used to be fine, but it has become more conservative as the platform has become smarter about memory management. I think it\u0027s time to retune the behavior along with platform changes. I am fine to change the behavior if the direction goes more aggressive. If some vendor concerns it since they use on their own policy, they could adjust LMKD knobs on their side.",
      "parentUuid": "db90171c_bd3e35aa",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8754906f_9d94fbae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-08T22:31:12Z",
      "side": 1,
      "message": "The issue is that there is no such knob today to tune the compression ratio in this calculation. Therefore partners can\u0027t tune this on their side.",
      "parentUuid": "d2b0ba3f_c35a704e",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e17b0815_1db88a55",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-08T22:52:53Z",
      "side": 1,
      "message": "Should I post a patch introducing compression ratio knob here? Would that be preperable?",
      "parentUuid": "8754906f_9d94fbae",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "37101c50_2e78c649",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2023-06-09T04:14:08Z",
      "side": 1,
      "message": "Does the *compression ratio* really matter for vendor? I thought waht they wanted is not compression ratio but how LMKD was aggressive than old. However, the aggressiveness(*side effect* from the original patch) is align with platform improvement trend now so what needed would retune the LMKD knobs to make it aggressive if they believe that\u0027s better for their workload.",
      "parentUuid": "e17b0815_1db88a55",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec7aab17_e8c00a02",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-09T17:18:43Z",
      "side": 1,
      "message": "For their case the new behavior causes excessive kills, so LMKD is too aggressive and the argument they make is that current logic assumes always the worst-case scenario (uncompressible data) which leads to this excessive killing. Compression ratio knob would allow partners to adjust that worst-case assumption to something more realistic. Does that make sense?",
      "parentUuid": "37101c50_2e78c649",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee44bdaa_399fc5ba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2023-06-09T17:21:26Z",
      "side": 1,
      "message": "Compression ratio knob is just bandaid to control the LMKD aggressiveness.",
      "parentUuid": "ec7aab17_e8c00a02",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ba46b33_064c0b62",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1157738
      },
      "writtenOn": "2023-06-09T17:32:12Z",
      "side": 1,
      "message": "I would not call that a bandaid. The original patch was developed to take into account the available space for ZRAM, however the truth is that the amount of data which can be fit there is larger than that number due to the compression ratio. How else can we reflect this fact?\n\nWhen talking about controlling LMKD aggressiveness, what is your suggestion to counterbalance this change in behavior?",
      "parentUuid": "ee44bdaa_399fc5ba",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a639c090_99c9f018",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1275554
      },
      "writtenOn": "2023-06-09T17:41:07Z",
      "side": 1,
      "message": "\"To make LMKD aggressive, tune the compression ratio knob\" - Isn\u0027t it too low level metric and also sounds strange since LMKD users need to be aware of how the LMKD is working with compression? That\u0027s all too low level detail and it\u0027s trying to expose low level implementation to control the LMKD\u0027s aggressiveness. \n\nNot sure what\u0027s the best knobs. What\u0027s the problem the low_swap limit you mentioned? I don\u0027t think we can avoid side effect but if that\u0027s align with platform changes, that\u0027s intended good fit. If the knob is not good by some reasons, can we make other representative knobs to control aggressiveness in LMKD instead of such an low level? And definitely the knob\u0027s default value would change depending on Android upgrade since it\u0027s intended behavior.",
      "parentUuid": "1ba46b33_064c0b62",
      "revId": "2a75718f4f1156c28d3853459002d94cd5f9bb83",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}